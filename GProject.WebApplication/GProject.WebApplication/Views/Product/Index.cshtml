@model Tuple<List<GProject.WebApplication.Models.ProductDTO>, List<GProject.Data.DomainClass.Color>,
List<GProject.Data.DomainClass.Size>, List<GProject.Data.DomainClass.Brand>,
List<GProject.Data.DomainClass.ViewHistory>>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using GProject.WebApplication.Models
@using GProject.Api.MyServices.Services;
@using GProject.Data.DomainClass;
@using GProject.WebApplication.Helpers;
@using GProject.Data.MyRepositories.IRepositories;
@{
    ViewBag.Title = "Danh sách sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";

    IPromotionRepository _IPromotionRepository = new PromotionRepository();
    IPromotionDetailRepository _IPromotionDetalRepository = new PromotionDetailRepository();

    var promotiondata = (from p in _IPromotionRepository.GetAll()
                         join q in _IPromotionDetalRepository.GetAll() on p.Id equals q.PromotionId
                         where p.Status == GProject.Data.Enums.PromotionStatus.Happenning
                         select new
                         {
                             Promotion = p,
                             PromotionDetail = q
                         }).ToList();

    List<Promotion> promotions = _IPromotionRepository.GetAll();
    Pager pager = new Pager();
    int pageNo = 0;

    if (ViewBag.Pager != null)
    {
        pager = ViewBag.Pager;
        pageNo = pager.CurrentPage;
    }

    IList<SelectListItem> StoreItems = new List<SelectListItem>();
    var lstBrand = await Commons.GetAll<Brand>(String.Concat(Commons.mylocalhost, "Brand/get-all-Brand"));
    int brand = int.Parse(Html.Encode(ViewData["brand"]));
    if (lstBrand.Count > 0)
    {
        StoreItems.Add(new SelectListItem()
                {
                    Value = "-1",
                    Text = " Nhãn hiệu ",
                    Selected = "-1" == brand.ToString(),
                });

        foreach (var br in lstBrand.Distinct().Where(x => x.Status == 1))
        {
            if (StoreItems.FirstOrDefault(c => c.Value == br.Id.ToString()) == null)
            {
                StoreItems.Add(new SelectListItem()
                        {
                            Value = br.Id.ToString(),
                            Text = br.Name,
                            Selected = br.Id == brand,
                        });
            }
        }
    }

    var lstCategory = await Commons.GetAll<Category>(String.Concat(Commons.mylocalhost, "Category/get-all-Category"));
    IList<SelectListItem> CategoryItems = new List<SelectListItem>();
    Guid category = new Guid(Html.Encode(ViewData["category"]));
    if (lstCategory.Count > 0)
    {
        CategoryItems.Add(new SelectListItem()
                {
                    Value = "-1",
                    Text = " Danh mục ",
                    Selected = "-1" == category.NullToString(),
                });

        foreach (var br in lstCategory.Where(x => x.Status == 1))
        {
            CategoryItems.Add(new SelectListItem()
                    {
                        Value = br.Id.ToString(),
                        Text = br.Name,
                        Selected = br.Id.ToString() == category.NullToString(),
                    });
        }
    }

    int checkPg = int.Parse(Html.Encode(ViewData["pg"]));
}


<div class="section-box">
    <div class="breadcrumbs-div">
        <div class="container">
            <ul class="breadcrumb">
                <li><a class="color-gray-1000" href="/Product/Index" style="font-size: 15px;">Trang chủ</a></li>
            </ul>
        </div>
    </div>
</div>
<section class="section-box shop-template mt-10">
    <div class="container">
        <div class="box-filters mt-0 pb-5">
            <div class="row">
                <!--Chỗ này để filter-->
                <div class="box-swiper">
                    <div class="swiper-container swiper-group-9">
                        <div class="swiper-wrapper pt-5">
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://cdn-icons-png.flaticon.com/512/0/747.png" alt="Ecom" style="max-width: 70%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Apple</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://static.vecteezy.com/system/resources/thumbnails/020/975/547/small_2x/samsung-logo-samsung-icon-transparent-free-png.png" alt="Ecom"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Samsung</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://cdn.icon-icons.com/icons2/2699/PNG/512/huawei_logo_icon_169026.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Huawei</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Xiaomi_logo_%282021-%29.svg/512px-Xiaomi_logo_%282021-%29.svg.png" style="max-width: 70%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Xiaomi</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://roadstreet.vn/wp-content/uploads/2017/10/logo_oppo.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Oppo</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://brandslogo.net/wp-content/uploads/2013/05/sony-corporation-vector-logo.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Sony</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/Dell_Logo.svg/768px-Dell_Logo.svg.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">DELL</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://cdn.icon-icons.com/icons2/2699/PNG/512/acer_logo_icon_169649.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">Acer</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="item-cat">
                                    <div class="box-category-1">
                                        <div class="box-image">
                                            <div class="inner-image"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ad/HP_logo_2012.svg/640px-HP_logo_2012.svg.png" alt="Ecom" style="max-width: 75%;"></div>
                                        </div>
                                        <div class="box-info">
                                            <a class="color-gray-900 font-md-bold" href="#">HP</a>
                                            <p class="font-xs color-gray-500"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex box-banner-vendor" style="padding: 24px 0px 20px 0px;">
            <div class="vendor-left">
                <div class="banner-vendor">
                    <img src="~/assets/imgs/page/vendor/featured.png" alt="Ecom">
                    <div class="d-flex box-info-vendor">
                        <div class="avarta"><img class="mb-5" src="~/assets/imgs/page/vendor/fasfox.png" alt="Ecom"><a class="btn btn-buy font-xs" href="shop-fullwidth.html">360 Products</a></div>
                        <div class="info-vendor">
                            <h4 class="mb-5">Fasfox Ecommerce</h4><span class="font-xs color-gray-500 mr-20">Thành lập 2023</span>
                            <div class="rating d-inline-block"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><span class="font-xs color-gray-500"> (65)</span></div>
                        </div>
                        <div class="vendor-contact">
                            <div class="row">
                                <div class="col-xl-7 col-lg-12">
                                    <div class="d-inline-block font-md color-gray-500 location mb-10">278 Lam Sơn, Đồng Tâm, Vĩnh Yên, Vĩnh Phúc</div>
                                </div>
                                <div class="col-xl-5 col-lg-12">
                                    <div class="d-inline-block font-md color-gray-500 phone">(+84) - 815-912-222<br>(+84) - 886-228-638</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="vendor-right">
                <div class="box-featured-product">
                    <div class="item-featured">
                        <div class="featured-icon"><img src="~/assets/imgs/page/product/delivery.svg" alt="Ecom"></div>
                        <div class="featured-info">
                            <span class="font-sm-bold color-gray-1000">Miễn Phí Giao Hàng</span>
                            <p class="font-sm color-gray-500 font-medium">From all orders over $10</p>
                        </div>
                    </div>
                    <div class="item-featured">
                        <div class="featured-icon"><img src="~/assets/imgs/page/product/support.svg" alt="Ecom"></div>
                        <div class="featured-info">
                            <span class="font-sm-bold color-gray-1000">Hỗ Trợ 24/7</span>
                            <p class="font-sm color-gray-500 font-medium">Shop with an expert</p>
                        </div>
                    </div>
                    <div class="item-featured">
                        <div class="featured-icon"><img src="~/assets/imgs/page/product/return.svg" alt="Ecom"></div>
                        <div class="featured-info">
                            <span class="font-sm-bold color-gray-1000">Hoàn Trả Tiền</span>
                            <p class="font-sm color-gray-500 font-medium">Free return over $200</p>
                        </div>
                    </div>
                    <div class="item-featured">
                        <div class="featured-icon"><img src="~/assets/imgs/page/product/payment.svg" alt="Ecom"></div>
                        <div class="featured-info">
                            <span class="font-sm-bold color-gray-1000">Thanh Toán An Toàn</span>
                            <p class="font-sm color-gray-500 font-medium">100% Protected</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="border-bottom mb-20 border-vendor"></div>
        <div class="row">
            <div class="col-lg-12">
                <div class="box-filters mt-0 pb-5 border-bottom">
                    <div class="row">
                        <!--Chỗ này để filter-->

                    </div>
                </div>
                <div class="list-products-5 mt-20">
                    @if (Model.Item1.ToList().Count() > 0)
                    {
                        @foreach (var x in Model.Item1.ToList())
                        {
                            var existProdPromotion = promotiondata.Where(c => c.PromotionDetail.ProductId == x.Product.Id).FirstOrDefault();
                            var getCategory = lstCategory.FirstOrDefault(c => c.Id == x.Product.CategoryId);
                            var getbrand = lstBrand.FirstOrDefault(c => c.Id == x.Product.BrandId);

                            <div class="card-grid-style-3 @getCategory.Id @getbrand.Id">
                                <!---->
                                <div class="card-grid-inner">
                                    <div class="tools"><a class="btn btn-trend btn-tooltip mb-10" href="#" aria-label="Trend" data-bs-placement="left"></a><a class="btn btn-wishlist btn-tooltip mb-10" href="shop-wishlist.html" aria-label="Add To Wishlist"></a><a class="btn btn-compare btn-tooltip mb-10" href="shop-compare.html" aria-label="Compare"></a><a class="btn btn-quickview btn-tooltip" aria-label="Quick view" href="#ModalQuickview" data-bs-toggle="modal"></a></div>
                                    <div class="image-box">
                                        @if (existProdPromotion != null && existProdPromotion.Promotion.DiscountPercent == 1)
                                        {
                                            <span class="label bg-brand-2">-@(existProdPromotion.Promotion.DiscountRate)%</span>
                                        }
                                        @if (existProdPromotion != null && existProdPromotion.Promotion.DiscountPercent == 0)
                                        {
                                            <span class="label bg-brand-2">-@(existProdPromotion.Promotion.DiscountRate)đ</span>
                                        }
                                        <a href="/productdetail/@x.Product.Id">
                                            @{
                                                string image = "";
                                                if (x.ProductVariations != null && x.ProductVariations.Count > 0)
                                                {
                                                    var imgItem = x.ProductVariations.Select(c => c.Image).FirstOrDefault();
                                                    image = imgItem != null ? imgItem : "";
                                                }
                                            }
                                            <img src="~/images/@image" alt="Ecom">
                                        </a>
                                    </div>
                                    <div class="info-right">
                                        <a class="font-xs color-gray-500" href="shop-vendor-single.html">@x.Brand.Name</a><br><a class="color-brand-3 font-sm-bold" href="shop-single-product-2.html">Samsung 36&quot; French door 28 cu. ft. Smart Energy Star </a>
                                        <div class="rating"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><img src="~/assets/imgs/template/icons/star.svg" alt="Ecom"><span class="font-xs color-gray-500">(65)</span></div>
                                        <div class="price-info">
                                            @if (existProdPromotion == null)
                                            {
                                                <strong class="font-lg-bold color-brand-3 price-main">@string.Format("{0:0,0} đ",Convert.ToDouble(x.Product.Price.ToString()))</strong>
                                            }
                                            else
                                            {
                                                <strong class="font-lg-bold color-brand-3 price-main">
                                                    @string.Format("{0:0,0} đ",Convert.ToDouble(existProdPromotion.PromotionDetail.CurrentPrice.ToString()))
                                                </strong>
                                                <span class="color-gray-500 price-line">
                                                    @string.Format("{0:0,0} đ", Convert.ToDouble(existProdPromotion.PromotionDetail.InitialPrice.ToString()))
                                                </span>
                                            }

                                        </div>
                                        <div class="mt-20 box-btn-cart"><a class="btn btn-cart" href="shop-cart.html">Xem chi tiết</a></div>
                                        <ul class="list-features">
                                            <li>27-inch (diagonal) Retina 5K display</li>
                                            <li>3.1GHz 6-core 10th-generation Intel Core i5</li>
                                            <li>AMD Radeon Pro 5300 graphics</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        }

                    }
                </div>
                <div class="mt-20">
                    <nav>
                        @if (pager.TotalPages > 0)
                        {
                            <ul class="pagination justify-content-end">
                                @if (pager.CurrentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" asp-controller="Product" asp-action="Index" asp-route-pg="@(pager.CurrentPage - 1)">
                                            Prev
                                        </a>
                                    </li>
                                }

                                @for (var pge = pager.StartPage; pge <= pager.EndPage; pge++)
                                {
                                    <li class="page-item @(pge == pager.CurrentPage ? "active" : "")">
                                        <a class="page-link" asp-controller="Product" asp-action="Index" asp-route-pg="@pge">@pge</a>
                                    </li>
                                }

                                @if (pager.CurrentPage < pager.TotalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" asp-controller="Product" asp-action="Index" asp-route-pg="@(pager.CurrentPage + 1)">
                                            Next
                                        </a>
                                    </li>
                                }
                            </ul>
                        }
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="section-box mt-90 mb-50">
    <div class="container">
        <ul class="list-col-5">
            <li>
                <div class="item-list">
                    <div class="icon-left"><img src="~/assets/imgs/template/delivery.svg" alt="Ecom"></div>
                    <div class="info-right">
                        <h5 class="font-lg-bold color-gray-100">Giao Hàng</h5>
                        <p class="font-sm color-gray-500">From all orders over $10</p>
                    </div>
                </div>
            </li>
            <li>
                <div class="item-list">
                    <div class="icon-left"><img src="~/assets/imgs/template/support.svg" alt="Ecom"></div>
                    <div class="info-right">
                        <h5 class="font-lg-bold color-gray-100">Hỗ Trợ 24/7</h5>
                        <p class="font-sm color-gray-500">Shop with an expert</p>
                    </div>
                </div>
            </li>
            <li>
                <div class="item-list">
                    <div class="icon-left"><img src="~/assets/imgs/template/voucher.svg" alt="Ecom"></div>
                    <div class="info-right">
                        <h5 class="font-lg-bold color-gray-100">Mã voucher</h5>
                        <p class="font-sm color-gray-500">Refer a friend</p>
                    </div>
                </div>
            </li>
            <li>
                <div class="item-list">
                    <div class="icon-left"><img src="~/assets/imgs/template/return.svg" alt="Ecom"></div>
                    <div class="info-right">
                        <h5 class="font-lg-bold color-gray-100">Hoàn Trả Tiền</h5>
                        <p class="font-sm color-gray-500">Free return over $200</p>
                    </div>
                </div>
            </li>
            <li>
                <div class="item-list">
                    <div class="icon-left"><img src="~/assets/imgs/template/secure.svg" alt="Ecom"></div>
                    <div class="info-right">
                        <h5 class="font-lg-bold color-gray-100">Thanh Toán</h5>
                        <p class="font-sm color-gray-500">100% Protected</p>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</section>